---
title: "Various phage cocktail scenarios"
author: "Bogna Smug"
date: "6/3/2020"
output:
  html_document: default
  pdf_document: default
---
## Recent changes to the model:
- **external depolymerase decays in time:** if it doesn't then bacteria under depo+P_N treatment either start growing very quickly or don't grow at all if depolymerase is strong enough  
- **bacteria stops bursting when it stops growing:** if it doesn't then phage cocktails are effective for very long as phages become free at the latest stage of experiment. The difference between those two scenarios can only be noticed at some specific parameter ranges.


## Summary:
**The efficiency of the phage cocktail is relatively robust to:**  
- initial bacteria biomass  
- initial resource concentration  
- the depolymerase activity  
- the mutation rate between capsuled and uncapsuled strains  


**It is temporarily sensitive to:**  
- depo phage killing ability (both adsorption rate and burst size) <initial phase of bacterial growth>  
- non-depo phage killing ability (both adsorption rate and burst size) <later phase of bacterial growth>  
- MOI (to certain extend): there may be moments when bacteria is allowed to grow again before phages will be able to multiplicate  
<span style="color:red">Note that the efficiency of standard single phage therapies are sensitive to many of the above factors</span>

**And is going to fail in long term if:**  
- bacteria are able to quickly mutate to yet another resistant strain   
- phage decay rate is high




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
#source('~/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/scripts/version5_2020_05/compare_coctail_and_depo_version_with_delayed_phages.R')
source('/Users/bognasmug/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/phage_cocktail_efficiency/compare_coctail_and_depo.R')

CFUFromOD = function(OD) {
  #CFU = as.numeric(mod$coefficients[1]) + as.numeric(mod$coefficients[2])*exp(OD)
  CFU = -1079035517 + 1014525658*exp(OD)
  return(CFU)
}
```

```{r read-in-data}
data486cocktails=readxl::read_excel(path = "/Users/bognasmug/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/data/2020_06/Dane dla Bogny2.xlsx", 
                sheet = "KP486 do papieru",
                range = "AL67:AU116")
data486depo=readxl::read_excel(path = "/Users/bognasmug/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/data/2020_06/Dane dla Bogny2.xlsx", 
                sheet = "KP486 do papieru",
                range = "AL121:AU170")
names(data486cocktails)[1] = "time"
names(data486depo)[1] = "time"
data486 = data486depo %>% 
  left_join(data486cocktails) %>%
  tidyr::gather(key = "treatment", value = "OD", -time) %>%
  mutate(CFU = CFUFromOD(OD),
         treatment = gsub(" ", "", treatment))


data77cocktails=readxl::read_excel(path = "/Users/bognasmug/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/data/2020_06/Dane dla Bogny2.xlsx", 
                sheet = "KP77 do papieru ",
                range = "BG65:BP114")
data77depo=readxl::read_excel(path = "/Users/bognasmug/MGG Dropbox/Bogna Smug/Z_Drulis_Kawa/data/2020_06/Dane dla Bogny2.xlsx", 
                sheet = "KP77 do papieru ",
                range = "BG126:BP175")
names(data77cocktails)[1] = "time"
names(data77depo)[1] = "time"
data77 = data77depo %>% 
  left_join(data77cocktails) %>%
  tidyr::gather(key = "treatment", value = "OD", -time) %>%
  mutate(CFU = CFUFromOD(OD),
         treatment = gsub(" ", "", treatment))

data77_1 = data77 %>% 
  filter(treatment %in% c("Kp77","Kp77+KP15","Kp77+KP36", "Kp77+KP36gp50", "Kp77+coctail(KP36gp50+KP15)", "Kp77+coctail(KP36+KP15)")) %>%
  mutate(type= "Kp77 + KP36 + KP15")

data77_2 = data77 %>% 
  filter(treatment %in% c("Kp77","Kp77+KP15","Kp77+KP34", "Kp77+KP34gp57", "Kp77+coctail(KP34gp57+KP15)", "Kp77+coctail(KP34+KP15)")) %>%
  mutate(type= "Kp77 + KP34 + KP15")

data77_3 = data77 %>% 
  filter(treatment %in% c("Kp77","Kp77+KP27", "Kp77+KP36","Kp77+KP36gp50", "Kp77+coctail(KP36gp50+KP27)", "Kp77+coctail(KP36+KP27)")) %>%
  mutate(type= "Kp77 + KP36 + KP27")

data77_4 = data77 %>% 
  filter(treatment %in% c("Kp77","Kp77+KP27", "Kp77+KP34","Kp77+KP34gp57", "Kp77+coctail(KP34gp57+KP27)", "Kp77+coctail(KP34+KP27)")) %>%
  mutate(type= "Kp77 + KP34 + KP27")

data77 = rbind(data77_1, data77_2, data77_3, data77_4)

data486_1 = data486 %>% 
  filter(treatment %in% c("Kp486","Kp486+KP15","Kp486+KP36",  "Kp486+KP36gp50", "Kp486+coctail(KP36gp50+KP15)", "Kp486+coctail(KP36+KP15)")) %>%
  mutate(type= "Kp486 + KP36 + KP15")

data486_2 = data486 %>% 
  filter(treatment %in% c("Kp486","Kp486+KP15", "Kp486+KP34", "Kp486+KP34gp57", "Kp486+coctail(KP34gp57+KP15)", "Kp486+coctail(KP34+KP15)")) %>%
  mutate(type= "Kp486 + KP34 + KP15")

data486_3 = data486 %>% 
  filter(treatment %in% c("Kp486","Kp486+KP27", "Kp486+KP36", "Kp486+KP36gp50", "Kp486+coctail(KP36gp50+KP27)", "Kp486+coctail(KP36+KP27)")) %>%
  mutate(type= "Kp486 + KP36 + KP27")

data486_4 = data486 %>% 
  filter(treatment %in% c("Kp486","Kp486+KP27", "Kp486+KP34", "Kp486+KP34gp57", "Kp486+coctail(KP34gp57+KP27)", "Kp486+coctail(KP34+KP27)")) %>%
  mutate(type= "Kp486 + KP34 + KP27")

data486 = rbind(data486_1, data486_2,data486_3, data486_4)


data = rbind(data486 %>% mutate(bacteria = "486"), data77 %>% mutate(bacteria = "77"))
data$treat = data$treatment
data$treat[data$treatment %in% c("Kp77", "Kp486")] = "All bacteria: no phage"
data$treat[data$treatment %in% c("Kp77+KP36gp50" , 
                                     "Kp77+KP34gp57",
                                     "Kp486+KP36gp50", 
                                     "Kp486+KP34gp57"
                                     )] = "All bacteria: external depo"
data$treat[data$treatment %in% c("Kp77+KP36" , 
                                 "Kp77+KP34",
                                 "Kp486+KP36", 
                                 "Kp486+KP34"
                                     )] = "All bacteria: with P_P only"
data$treat[data$treatment %in% c("Kp77+KP15" , 
                                 "Kp77+KP27",
                                 "Kp486+KP15", 
                                 "Kp486+KP27"
                                     )] = "All bacteria: with P_N only"
data$treat[data$treatment %in% c("Kp77+coctail(KP34gp57+KP27)" , 
                                 "Kp77+coctail(KP34gp57+KP15)",
                                 "Kp77+coctail(KP36gp50+KP27)", 
                                 "Kp77+coctail(KP36gp50+KP15)",
                                 "Kp486+coctail(KP34gp57+KP27)" , 
                                 "Kp486+coctail(KP34gp57+KP15)",
                                 "Kp486+coctail(KP36gp50+KP27)", 
                                 "Kp486+coctail(KP36gp50+KP15)"
                                     )] = "All bacteria: with P_N plus depo"

data$treat[data$treatment %in% c("Kp77+coctail(KP34+KP27)" , 
                                 "Kp77+coctail(KP34+KP15)",
                                 "Kp77+coctail(KP36+KP27)", 
                                 "Kp77+coctail(KP36+KP15)",
                                 "Kp486+coctail(KP34+KP27)" , 
                                 "Kp486+coctail(KP34+KP15)",
                                 "Kp486+coctail(KP36+KP27)", 
                                 "Kp486+coctail(KP36+KP15)"
                                     )] = "All bacteria: P_N & P_P"


colors = c("All bacteria: no phage" = "black",
              "All bacteria: external depo" = "gray",
              "All bacteria: with P_P only" = "green",
              "All bacteria: with P_N only" = "blue",
              "All bacteria: with P_N plus depo" = "magenta",
              "All bacteria: P_N & P_P" = "red")
```
## Experimental Data

```{r compare-to-data, , out.width = "99%", fig.height = 3}

ggplot(data = data %>% filter(bacteria == "77") %>% rename(Treatment = treat),
       aes(x = time, y = CFU, col = Treatment)) +
  geom_line() +
  facet_grid(bacteria ~ type)+
  theme(text = element_text(size=6)) +
  ylim(-5*10^7, 3*10^9)  +
  scale_color_manual(values=colors) 

ggplot(data = data %>% filter(bacteria == "486") %>% rename(Treatment = treat),
       aes(x = time, y = CFU, col = Treatment)) +
  geom_line() +
  facet_grid(bacteria ~ type) +
  theme(text = element_text(size=6)) +
  ylim(-5*10^7, 3*10^9) +
  scale_color_manual(values=colors) 
```

```{r}
# PARAMETERS
Tmax = 24


# initial values
# started with 10^6 CFU/mL i.e. 10^9 CFU/L i.e. ~10^(-3) g/L
mg_count = (10^12) 
B0  = 10^9/mg_count #[g/L]
MOI = 10 # so  both phages and bacteria are now counted in units of (10^12) 
G0 = 55.6

# Weitz: K= 4*10^(-6)g/mL = 4*10^(-3)g/L (4miligram per liter ~ 0.01 mmol/L)
# according to https://www.ncbi.nlm.nih.gov/pmc/articles/PMC98929/
# K for E-Coli is in the range of 40-100 000 miligrams/L i.e. 0.15-500 mmol/L


# fitted to KP77, f24 h
#Vh=348.90
#Kh=500
#a=0.042

# fitted to KP77, first 4 h
# VERY QUICK GROWTH AS IN THE FIRST 4h
Vh=640.24
Kh=500
a=0.04

# fitted to Kp486, first 4h
#Kh=500
#Vh=809.5
#a=0.039

# fagi z depolimerazą są mniejsze więc krocej się namnażają
# burst size
# Weitz 2005: burst size = 71
# Da Paeppe: burst size = 50-3600
# Cairns 2009:: burst size ~ 2
beta_non_depo = 15
beta_depo = 50



# adsororption rate to the specific phage
# Cairns 2009: adsorption ~ 8*10^(-8) ml/(CFU*h). After converting CFU to mg we get: 10^9 * 8*10^(-8) ~ 80
# Weitz 2005: adsorrption ~ 6.24*10^(-8) ml/[hr*CFU].  i.e. 6.24*10^(-11) L/[hr*CFU] i.e. ~ 62.4 L/[hr * 10^12 phage cells]
#phi_non_depo = 0.25; # phage 1 (with depolymerase) to bacteria with polisaccharide
#phi_depo = 0.25; # phage 2 (without depolimerase) to bacteria without polissacharide
# Da Paeppe 10^(-11) - 10^(-9) [1/min] = 10^(-9)-10^(-7) [1/min] i.e 1-100
phi_non_depo = 20
phi_depo = 20

# phage decay rate
#Cairns 2009 decay = 0.0106 [1/h], This constant doesn't depend on the unit of phages. 
# Levin 2004 decay: 0.1 [1/h]
# Da Paeppe 0.07-0.5 [1/24h] = 0.003-0.2 [1/h]
#So it is ok if we count phages in units of 10^12
decay = 0.0106; 

# depolymerase activity
depo_decay_rate = 0.2;
e0 = 0.9; # when added depolymerase
c=0;
V_depo = 5; #15; # depolymerase max activity
K_depo = 1; # 5 depolymerase Michaelis Menten constant
# as in Michaelis Menten kinetics V = e_0 * k_2 where e_0 is the enzyme concentration

#mutation rate
epsilon = 10^(-6)
#epsilon2= 0.00005
epsilon2 = 10^(-20)
epsilon3 = 0
epsilonB2toB1 = epsilon
epsilonB1toB2 = epsilon
epsilonB2toB3 = epsilon2
epsilonB3toB2 = epsilon2
epsilonB1toB3 = epsilon3
epsilonB3toB1 = epsilon3

```

## <span style="color:blue">  Sequential vs Parallel cocktail </span>

### <span style="color:blue">  Assuming all the receptors are dropped at once </span>
We see that a parallel cocktail is effective in short term although in long term it is not any better than a single phage and that the bacteria becomes resistant to it same quickly as it became resistant to one phage and much quicker than to the sequential phage cocktail.

```{r, out.width = "50%"}
    colors2 = c("All bacteria: no phage" = "black",
               "All bacteria: sequential cocktail" = "red",
               "All bacteria: parallel cocktail" = "darkblue")

  # No external depolimerase: different combinations of phages
  descriptions = c("All bacteria: no phage",
                   "All bacteria: sequential cocktail",
                   "All bacteria: parallel cocktail")
  
# Finaly evalutate simulation
Compare_Sequential_And_Paralel_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "",
                       colors = colors2)
```

### <span style="color:blue">  Assuming receptors are lost independently with the same probability </span>
and that the Non-depo phage can attach to bacteria that lost one specific receptor (no necessarily the other)

```{r}
beta2 = beta_non_depo
phi2=phi_non_depo
  pars =  c(a = a, 
            Vh = Vh, 
            Kh = Kh,
            beta_non_depo = beta_non_depo, 
            beta2 = beta2,
            beta_depo = beta_depo, 
            phi_non_depo = phi_non_depo, 
            phi2 = phi2, 
            phi_depo = phi_depo,
            decay = decay, 
            bf = 1,
            epsilonB2toB1 = epsilon, 
            epsilonB1toB2 = epsilon,
            epsilonB2toB4 = epsilon,
            epsilonB4toB2 = epsilon,
            epsilonB1toB3 = epsilon,
            epsilonB3toB1 = epsilon,
            epsilonB3toB4 = epsilon,
            epsilonB4toB3 = epsilon
            )
  
  time = seq(0,Tmax,1)
  P0=B0*MOI;  
inits = 
            c(G = G0, 
              Pdepo = 0.5*P0,
              P2 = 0,
              Pnondepo = 0.5*P0,
              B1= B0,
              B2 = 0,
              B3 = 0,
              B4 = 0)

    simulation <- as.data.frame(ode(inits, time, two_simultaneous_phages_and_bacteria_with_two_receptors, pars))%>%
      mutate(bacteria = B1+B2+ B3+B4) %>%
      select(time, bacteria) %>%
      mutate(description = descriptions[2])
    simulated_data = simulation
    
    inits['Pdepo'] = 0
    inits['Pnondepo'] = 0
    simulation <- as.data.frame(ode(inits, time, two_simultaneous_phages_and_bacteria_with_two_receptors, pars))%>%
      mutate(bacteria = B1+B2+ B3+B4) %>%
      select(time, bacteria) %>%
      mutate(description = descriptions[1])
    simulated_data = rbind(simulated_data, simulation) 
    
    inits['Pdepo'] = 0.5*P0
    inits['Pnondepo'] = 0
    inits['P2'] = 0.5*P0
    simulation <- as.data.frame(ode(inits, time, two_simultaneous_phages_and_bacteria_with_two_receptors, pars))%>%
      mutate(bacteria = B1+B2+ B3+B4) %>%
      select(time, bacteria) %>%
      mutate(description = descriptions[3])
    simulated_data = rbind(simulated_data, simulation) 
        
  ggplot(simulated_data,
         aes(x = time, y = bacteria, col = description)) +
    #scale_color_manual(values=colors) +
    geom_line() +
    theme_bw() +      
    scale_color_manual(values=colors2) +
    ggtitle("Comparison of sequential and parallel phage cocktails")
```

## Main scenarios covered by our model:
### 1) Default i.e. effective cocktail
#### Describes:
 
- Bacteria: Kp486 + KP34 + KP27 
- Bacteria: Kp486 + KP36 + KP27
- Bacteria: Kp77 + KP34 + KP27
- Bacteria: Kp77 + KP36 + KP27
- Bacteria: Kp77 + KP34 + KP15 
- Bacteria: Kp77 + KP36 + KP15

#### Parameters
- mutation rate: `r epsilon` 
- mutations just between capsuled and uncapsuled strains  
- phage decay: `r decay`  
- no free depolymerase (detached from depolymerase phages)  
- adsorption rates: (i) `r phi_depo` for depo phage (P_P), (ii) `r phi_non_depo` for non-depo phage  (P_N)  
- burst sizes: (i) `r beta_depo` for depo phage (P_P), (ii) `r beta_non_depo` for non-depo phage (P_N)

#### Results:  
Non-depo phage plus external depolymerase is more effective than just the non-depo phage but much less effective than the phages cocktail.

```{r}
# Finaly evalutate simulation
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo,                                                            
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT")

# Very qick growth all the time, whereas in experiments it slows down a lot

# P_P here grows to same density as all bacteria. In practice tehy grow to a smaller density. It may eb because
# a) in the culture there is not enough oxygen for entire 24h
# b) there may be some fitness effects of the mutation
```


```{r compare-to-data-2, fig.height = 3, out.width = "99%"}

ggplot(data = data %>% filter(type %in% c("Kp486 + KP34 + KP27", "Kp486 + KP36 + KP27",
                                          "Kp77 + KP34 + KP27",
                                          "Kp77 + KP36 + KP27",
                                          "Kp77 + KP36 + KP15",
                                          "Kp77 + KP34 + KP15")) %>% rename(Treatment = treat),
       aes(x = time, y = CFU, col = Treatment)) +
  geom_line() +
  facet_grid(. ~ type)+
  theme(text = element_text(size=6)) +
  ylim(-5*10^7, 3*10^9)  +
  scale_color_manual(values=colors) +
  ggtitle("Data covered by our model")

```

###  <span style="color:blue"> 2a) Unequal division of mucoidal forms </span>
Those that are only resistant to KP15 are more likely and those that are only resistant to KP27 are less likely.

#### Describes:
- Bacteria: Kp486 + KP36 + KP15
- Bacteria: Kp486 + KP34 + KP15

#### Parameters
- mutation rates: epsilonB1toB2 < default, epsillonB1toB3 > default

#### Results
 - higher bacteria growth under the phage cocktail, especially when the mutation rate to bacteria that are resistant to our non-depo phage is higher (i.e. when we assume more mucoidal forms are resistant to KP15 than to KP27)
 - note: those mutants in longer timespan will grow much higher than seen in the experiments. This is probably because there is some fitness cost of being mucoid that we do not assume here

```{r,echo=FALSE, fig.show = "hold", out.width = "32%"}

# In KP77 cells do not become mucoid therefore very low chances of becoming quickly resistant to both phages: sepo and non-depo: epsilonB1toB3 = epsilonB2toB3 = 0.0001
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", 
                       colors=colors)
# In KP486: fewer cells loose the capsule as such but more become mucoid.
# If we divide mucoid cells into B2 (sensitive to KP15) and B3 (resistant to both) it turns out the flux of
# capsuled bacteria to bacteria resistant to both types (B3) epsilonB1toB3 is larger than in the case of KP77


# SOME OF THE MUCOIDAL FORMS THAT ARE CREATED DIRECTLY FROM B1 ARE RESISTANT TO EVERYTHING
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilon2, 
                       epsilonB3toB2=epsilon2,
                       epsilonB1toB3=epsilon3,
                       epsilonB3toB1=epsilon3,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "SOME MUCOIDAL FORMS INSTEAD OF UNCAPSULED: \n NONE RESIATNT TO P_N (KP27) = DEFAULT", colors=colors)

# KP15: bad at clearing bacteria
alpha = 0.96 # % of the new forms that will be sensitive to non-depo phage either due to 
# not having capsule or being only partially mucoidal and still having the receptors for the non-depo phage
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilon2, 
                       epsilonB3toB2=epsilon2,
                       epsilonB1toB3=epsilon2 + 10^(-20),
                       epsilonB3toB1=epsilon2,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "SOME MUCOIDAL FORMS INSTEAD OF UNCAPSULED: \n SOME RESIATNT TO P_N (KP15)", colors=colors)

# The mucoidal form probably has some fitness costs and has less oxygen
# This is why it grows to a lesser extend in experiments
```
```{r compare-to-data-3, fig.height = 3, out.width = "99%"}

ggplot(data = data %>% filter(type %in% c("Kp486 + KP34 + KP15",
                                          "Kp486 + KP36 + KP15"
                                          )) %>% rename(Treatment = treat),
       aes(x = time, y = CFU, col = Treatment)) +
  geom_line() +
  facet_grid(. ~ type)+
  theme(text = element_text(size=6)) +
  ylim(-5*10^7, 3*10^9)  +
  scale_color_manual(values=colors) +
  ggtitle("Data covered by our model")

```

### 2b) <span style="color:red">Lower burst size for Non-depo phage <or some bacterial resistance against that phage></span>
#### Describes:
- Bacteria: Kp486 + KP36 + KP15
- Bacteria: Kp486 + KP34 + KP15


#### Parameters
- burst sizes: (i) 5 for non-depo phage (P_N), (ii) `r beta_depo` for depo phage (P_P)

#### Results
 - higher bacteria growth under the phage cocktail and P_N plus depo treatments  
 -  <span style="color:red"> In the experimental data we do not observe a drop in P_N + depo treatment. This is not clear why if the non-depo phage is not very successful at infecting the Kp486 bacteria. </span>

```{r,echo=FALSE}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT")
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo/100, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOW NON_DEPO PHAGE BURST SIZE")
```


```{r compare-to-data-4, fig.height = 3, out.width = "99%"}

ggplot(data = data %>% filter(type %in% c("Kp486 + KP34 + KP15",
                                          "Kp486 + KP36 + KP15"
                                          )) %>% rename(Treatment = treat),
       aes(x = time, y = CFU, col = Treatment)) +
  geom_line() +
  facet_grid(. ~ type)+
  theme(text = element_text(size=6)) +
  ylim(-5*10^7, 3*10^9)  +
  scale_color_manual(values=colors) +
  ggtitle("Data covered by our model")

```

## Other scenarios covered by our model:
### <span style="color:blue">  3a) Cocktails at different proportions of P_N and P_P </span>
#### Parameters 
- beta_non_depo = 5
- propPN = 0.1, propPN = 0.9

#### Results
- Manipulation of the initial phage frequency may be useful when we know one of the phages is weaker than the other.
For example if the non depo phage has a low burst size and we add more of it to the mixture then we keep the bacteria load lower for a longer time than when mixing phages in the proportion 1:1.

```{r,echo=FALSE, fig.show = "hold", out.width = "32%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo/10, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT WITH LOW P_N BURT SIZE", colors=colors,
                       propPP = 0.5)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo/10, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "COCKTAIL WITH 10% P_N and 90% P_P", 
                       colors=colors,
                       propPP = 0.9)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo/10, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "COCKTAIL WITH 90% P_N and 10% P_P", 
                       colors=colors,
                       propPP = 0.1)
```

### <span style="color:blue">  3b) Cocktails with some initial uncapsuled bacteria </span>
#### Parameters 
propB2init = 0.01

#### Results
Similar behaviour can be obtained when either  
- the mutation rate from capsuled to uncapsuled bacteria is high (default behavior)  
- the mutation rate from capsuled to uncapsuled bacteria is low but there are some uncapsuled bacteria in the initial population   
In the second case the amount of external depolymerase to fight the capsuled bacteria can be about twice lower that in the seond case

```{r,echo=FALSE, fig.show = "hold", out.width = "49%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT WITH MUTATION TO B2 RATE", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=0, 
                       epsilonB1toB2=0,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT WITH N) MUTATION TO B2 \n BUT SOME INITIAL B2", 
                       colors=colors,
                       propB2init = 10^(-6))



```






### 4a) Lower burst size for depo phage <or some bacterial resistance against that phage>
#### Parameters
- burst sizes: (i) `r beta_non_depo` for non depo phage (P_N), (ii) 5 for depo phage (P_P)

#### Results
- quicker bacteria growth under P_P therapy  <span style="color:red">(but lower after 24h!)</span>
- quicker and higher bacteria growth under cocktail therapy

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", 
                       colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo/20, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOW DEPO PHAGE BURST SIZE", colors=colors)
```



### 4b) Quicker phage decay
#### Parameters
- phage decay: 1

#### Results
- under P_N treatment bacteria can grow same well as when there is no phage (i.e. P_N will decay before capsuled bacteria mutate)
- all treatments are less effective, especially the phage cocktail

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax,
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=100*decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGH DECAY RATE", colors=colors)
```

### 5a) <span style="color:red">Quicker mutation</span>
#### Parameters
- mutation rate: 0.05

#### Results
- single treatments (P_P or P_N only) are affected the most and they are more effective. This is because bacteria that mutate too easily will mutate back towards the mutants that are easily cleared by phages

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
epsilon = 0.05
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilon, 
                       epsilonB1toB2=epsilon,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGH MUTATION RATE", colors=colors)
```


### 5b) Slower mutation
#### Parameters
- mutation rate: 0.0001

#### Results
- single treatments (P_P only and P_N plus depo) are affected the most and they are more effective. This is because bacteria will not escape the phage infection that easily.

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
epsilon = 0.001
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilon, 
                       epsilonB1toB2=epsilon,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGH MUTATION RATE", colors=colors)
```


### 6) <span style="color:red">There is another strain to which uncapsuled bacteria can mutate</span>
#### Parameters
- mutation rate (capsuled to a new resistant mutant): 0.001

#### Results
- the phage cocktail treatment stops being effective in a longer timescale (although it keeps working pretty well for the first ~20 hours)

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
epsilon = 0.001
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilon, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "ANOTHER RESISTANT MUTANT", colors=colors)
```

### 7) The depolymerase encoded by depo phage becomes freely available in the environment
#### Parameters 
- c: 1

#### Results
- the most affected is the treatment under a single depo phage (P_P) and it becomes less effective. This is because the free depolymerase converts capsuled strains into uncapsuled ones and the depo phages (P_P) can't attach to those

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=1, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "FREE DEPOLYMERASE", colors=colors)
```


### 7b) The external depolymerase doesn't decay
#### Parameters 
- depo_decay_rate = 0

#### Results
- the P_N plus depo treatment becomes much more effective

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=0,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEPOLYMERASE DOESN'T DECAY", colors=colors)
```

### 8) The depo phage depolymerase is stronger
#### Parameters 
- V_depo: 10

#### Results
- It affects the P_N plus depo treatment which becomes more effective.
In the main version of the model the strength of depolymerase doesn't change the killing rate so it only affect the treatment where depo is supplied externally

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo*2, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "STRONGER DEPO", colors=colors)
```

### 9) Higher adsorption rate of the depo phage (P_P)
#### Parameters
- phi_depo: 2

#### Results
- treatments under the depo phage (P_P) and under the phage cocktail become more effective and they postpone bacterial regrowth

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=100*phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGHER ADSORPTION OF P_P", colors=colors)
```

### 10) <span style="color:red">Lower adsorption rate of the depo phage (P_P)</span>
#### Parameters 
- phi_depo: 0.05

#### Results
- treatments under the depo phage (P_P) and under the phage cocktail become less effective in the short timescale (first 10 hours) but P_P becomes more effective in the longer timescale. This is probably due to a smaller pressure to loose a capsule and to escape the depo phage invasion.


```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo/5, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOWER ADSORPTION OF P_P", colors=colors)
```

### 11) Higher adsorption rate of the non-depo phage (P_N)
#### Parameters 
- phi_non_depo: 1

#### Results
- no much effect, interestingly the depo + P_N works for longer

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=4*phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGHER ADSORPTION OF P_N", colors=colors)
```


### 12) Lower adsorption rate of the non-depo phage (P_N)
#### Parameters
- phi_non_depo: 0.05

#### Results
- the phage cocktail treatments becomes less effective  
- the P_N + depo treatment becomes less effective in short term and  <span style="color:red">more effective in long term</span>

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo/5, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOWER ADSORPTION OF P_N", colors=colors)
```

### 13) Lower MOI
#### Parameters
- MOI:0.1

#### Results
- Bacteria grows initially before phages multiplicate enough to start clearing the bacteria

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =0.1, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOWER MOI", colors=colors)
```


### 14) <span style="color:red">Higher glucose concentration</span>
#### Parameters
- G0:58

#### Results
- Bacteria grows quickly before phages multiplicate enough to start clearing the bacteria  
- Interestingly phage cocktail keeps being same effective

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=2*G0, 
                       Tmax = Tmax, 
                       title_plot = "HIGHER RESOURCE", colors=colors)
```


### 16)<span style="color:red"> Higher initial biomass </span>
#### Parameters
- B0:0.25

#### Results
- Interestingly, phage therapies are much more effective in this case.
This is known as 'proliferation threshold' i.e: bacteria that are very abundant at the beginning get cleared by phages quicker

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=10*B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOWER IITIAL BIOMASS", colors=colors)
```

### 15) Lower biomass
#### Parameters
- B0:0.01

#### Results
- The dynamics is slower: some lag before bacteria start growing

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0/10, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "LOWER IITIAL BIOMASS", colors=colors)
```

### 16) Bacteria keeps releasing phages after it stops growing and phage decay rate is high
#### Parameters 
- bf = 0
- decay = 1

#### Results
- The cocktail is effective for too long because phages come back to the environment even after the bacteria stops growing

```{r,echo=FALSE, fig.show = "hold", out.width = "50%"}
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=decay, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "DEFAULT", colors=colors)
Simulate_Phage_Coctail(Vh=Vh, 
                       Kh=Kh,
                       a=a, 
                       beta_non_depo=beta_non_depo, 
                       beta_depo=beta_depo, 
                       phi_non_depo=phi_non_depo, 
                       phi_depo=phi_depo, 
                       decay=1, 
                       V_depo=V_depo, 
                       K_depo=K_depo, 
                       c=c, 
                       depo_decay_rate=depo_decay_rate,
                       epsilonB2toB1=epsilonB2toB1, 
                       epsilonB1toB2=epsilonB1toB2,
                       epsilonB2toB3=epsilonB2toB3, 
                       epsilonB3toB2=epsilonB3toB2,
                       epsilonB1toB3=epsilonB1toB3, 
                       epsilonB3toB1=epsilonB3toB1,  
                       B0=B0, 
                       e0=e0, 
                       MOI =MOI, 
                       G0=G0, 
                       Tmax = Tmax, 
                       title_plot = "BACTERIA KEEP BURSTING AFTER CEASED GROWTH", 
                       colors=colors,
                       bf = 0)
```



